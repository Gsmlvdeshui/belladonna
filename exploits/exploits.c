#include <stdlib.h>
#include <stddef.h>
#include <exploits.h>

#include <checkm8/checkm8.h>

exploit_list_t* exploits = NULL;

static void exploit_add(char* name, exploit_supported_t supported, exploit_func_t exploit) {
	exploit_list_t* new_exploit = malloc(sizeof(exploit_list_t));
	new_exploit->name = name;
	new_exploit->supported = supported;
	new_exploit->exploit = exploit;
	new_exploit->next = exploits;
	exploits = new_exploit;
}

void exploits_init() {
#ifdef CHECKM8
	exploit_add("checkm8", &checkm8_supported, &checkm8_exploit);
#endif

#ifdef SHATTER
	exploit_add("shatter", &shatter_supported, &shatter_exploit);
#endif

#ifdef LIMERA1N
	exploit_add("limera1n", &limera1n_supported, &limera1n_exploit);
#endif

#ifdef STEAKS4UCE
	exploit_add("steaks4uce", &steaks4uce_exploit, &steaks4uce_exploit);
#endif

#ifdef PWNAGE2
	exploit_add("pwnage2", &pwnage2_supported, &pwnage2_exploit);
#endif
}

void exploits_exit() {
	exploit_list_t* exploit = exploits;
	exploit_list_t* to_free;
	while(exploit != NULL) {
		to_free = exploit;
		exploit = to_free->next;
		free(to_free);
	}
	exploits = NULL;
}